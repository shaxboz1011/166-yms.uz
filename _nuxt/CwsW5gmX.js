import T from"./Dbk_wj-6.js";import q from"./CSCtDFJX.js";import U from"./BKNC8iEG.js";import j from"./NI_5f7sy.js";import N from"./8TWmm3E1.js";import B from"./DKsq0fTf.js";import M from"./Bpz0ISFD.js";import R from"./CSXYzY5V.js";import A from"./BO3xBH8t.js";import L from"./65GFK_Nr.js";import O from"./BF47hSpE.js";import X from"./jenkQ3LR.js";import z from"./UwnqmTQN.js";import E from"./du96AcDJ.js";import{_ as H,c as u,b as t,a as i,w as r,F as Q,o as f,t as c,k as Y,j as J,d as v}from"./Zg9QAtjx.js";import"./CLs7nh7g.js";import"./Cp8PWo7p.js";import"./UdZWUTXm.js";import"./CtWzM0t5.js";import"./mL8Il5wu.js";import"./CY8zZqY-.js";import"./RDXR7HGb.js";import"./zI39C9iN.js";import"./Cy0yQzXU.js";import"./aL5z7nC8.js";import"./CQVc-1iD.js";import"./Da49ZmCy.js";import"./DH97D8aY.js";import"./D91UozF_.js";import"./IQ7TQB1o.js";import"./BxaurArh.js";import"./jc0MLXVe.js";import"./LxCXqkmB.js";import"./CcRuFUDx.js";import"./C20ysC0u.js";import"./ZhWAdK_X.js";import"./CMpKHNoI.js";import"./DtYP-8bJ.js";import"./QKNk21la.js";import"./CtTDw-BO.js";import"./CYdRYw-3.js";import"./C1SMoSWM.js";import"./LqXTRE-S.js";import"./DSAzKssw.js";import"./CGFDNTbK.js";import"./BL9DFAkF.js";import"./BLBshB8N.js";import"./Bqhk9j0P.js";import"./C7OUcc1D.js";import"./D9Ev0HEd.js";import"./Bx_1MDx-.js";import"./C-fZERAR.js";import"./CXloDhuq.js";import"./C3l17qcE.js";import"./B92Vec8q.js";import"./BhLYwMiy.js";import"./BNjfoiHH.js";const P={setup(){},mounted(){this.loadStaffs(),this.loadSpecialities()},data(){return{search:"",staffs:[],specialities:[],expandedRows:null,dialog:!1,deleteDialog:!1,editId:null,deleteItem:null,deleteStoryDialog:!1,storyToDelete:null,form:{fullname:"",qualification:"",description:"",phoneNumber:"",specialityIds:[],price:"",passportFiles:[]},passport:{file:null,src:null,type:null},storyDialog:!1,currentStaff:null,editingStoryId:null,storyForm:{description:"",price:"",status:""},storyStatuses:["Xayfsan","Rag'batlantirish","Pensiya","Ishdan bo'shash","Mehnat shartnomasi bekor qilingan"],idcount:0,idStoriesCount:0}},computed:{items(){return this.staffs.filter(l=>l.fullname.toLowerCase().includes(this.search.toLowerCase())).sort((l,e)=>e.id-l.id)},isFormComplete(){return this.form.fullname&&this.form.qualification&&this.form.description&&this.form.phoneNumber&&this.form.specialityIds.length&&this.form.price!==""}},methods:{loadStaffs(){const l=localStorage.getItem("staffs");this.staffs=l?JSON.parse(l):[]},saveStaffs(){localStorage.setItem("staffs",JSON.stringify(this.staffs))},loadSpecialities(){const l=localStorage.getItem("specialities");this.specialities=l?JSON.parse(l):[]},refreshWorkerData(){localStorage.clear(),this.staffs=[],this.specialities=[],this.expandedRows=null,this.$toast.add({severity:"warn",summary:"LocalStorage tozalandi",life:2e3})},openCreate(){this.resetForm(),this.dialog=!0},openEdit(l){this.resetForm(),this.form={fullname:l.fullname,qualification:l.qualification,description:l.description,phoneNumber:l.phoneNumber,specialityIds:l.specialityIds,price:l.price,passportFiles:[]},l.passportBase64&&(this.passport={src:l.passportBase64,type:"image"}),this.editId=l.id,this.dialog=!0},saveItem(){const l=this.editId?this.staffs.find(p=>p.id===this.editId):null,e={id:this.editId??++this.idcount,...this.form,passportBase64:this.passport.src||null,stories:l?.stories||[]};if(this.editId){const p=this.staffs.findIndex(h=>h.id===this.editId);this.staffs[p]=e,this.$toast.add({severity:"success",summary:"Yangilandi",life:2e3})}else this.staffs.push(e),this.$toast.add({severity:"success",summary:"Qo‘shildi",life:2e3});this.saveStaffs(),this.dialog=!1,this.resetForm()},openDeleteDialog(l){this.deleteItem=l,this.deleteDialog=!0},confirmDelete(){this.staffs=this.staffs.filter(l=>l.id!==this.deleteItem.id),this.saveStaffs(),this.deleteDialog=!1,this.$toast.add({severity:"success",summary:"O‘chirildi",life:2e3})},onFileSelect(l){const e=l.files[0];if(!e)return;const p=new FileReader;p.onload=h=>{this.passport={src:h.target.result,type:"image"}},p.readAsDataURL(e),this.form.passportFiles=[e]},removeFile(){this.passport={file:null,src:null,type:null},this.form.passportFiles=[]},resetForm(){this.editId=null,this.form={fullname:"",qualification:"",description:"",phoneNumber:"",specialityIds:[],price:"",passportFiles:[]},this.passport={file:null,src:null,type:null}},statusColor(l){return{Xayfsan:"danger","Rag'batlantirish":"success",Pensiya:"info","Ishdan bo'shash":"warning","Mehnat shartnomasi bekor qilingan":"secondary"}[l]||"info"},openStoryCreate(l){this.currentStaff=l,this.editingStoryId=null,this.storyForm={description:"",price:"",status:""},this.storyDialog=!0},openStoryEdit(l){if(this.currentStaff=this.staffs.find(e=>Array.isArray(e.stories)&&e.stories.some(p=>p.id===l.id)),!this.currentStaff){console.error("Staff topilmadi");return}this.editingStoryId=l.id,this.storyForm={...l},this.storyDialog=!0},saveStory(){if(!this.currentStaff){console.error("currentStaff null");return}if(Array.isArray(this.currentStaff.stories)||(this.currentStaff.stories=[]),this.editingStoryId){const l=this.currentStaff.stories.findIndex(e=>e.id===this.editingStoryId);l!==-1&&(this.currentStaff.stories[l]={...this.storyForm,id:this.editingStoryId})}else this.currentStaff.stories.push({id:++this.idStoriesCount,...this.storyForm});this.saveStaffs(),this.storyDialog=!1,this.editingStoryId=null},openDeleteStoryDialog(l,e){this.storyToDelete=l,this.currentStaff=e,this.deleteStoryDialog=!0},confirmDeleteStory(){!this.currentStaff||!this.storyToDelete||(this.currentStaff.stories=this.currentStaff.stories.filter(l=>l.id!==this.storyToDelete.id),this.saveStaffs(),this.$toast.add({severity:"success",summary:"Tarix o‘chirildi",life:2e3}),this.deleteStoryDialog=!1,this.storyToDelete=null)}}},W={class:"flex justify-center mt-5"},G={class:"w-[90%] flex justify-between items-center"},K={class:"flex justify-start items-center"},Z={class:"flex justify-end items-start gap-2"},$={class:"flex justify-center mt-4"},ee={key:0},se={key:1,class:"text-gray-400 text-sm"},te={key:0},ie={key:1,class:"text-gray-400 text-sm"},oe=["src"],le=["src"],re={key:1,class:"text-gray-400 text-sm"},ne={class:"p-3"},ae={class:"flex gap-2"},de={class:"p-2"},me={class:"flex items-center mb-3"},pe={class:"flex items-center mb-3"},fe={class:"flex items-center mb-3"},ue={class:"flex items-center mb-3"},ce={class:"flex items-center mb-3"},he={class:"flex items-center mb-3"},ye={class:"flex items-center justify-start mb-3"},be={class:"flex justify-start gap-2 items-center"},ge={key:0,class:"relative inline-block"},ve=["src"],xe=["src"],Se={class:"flex justify-end gap-2 pt-3"},ke={class:"flex items-center mb-3"},we={class:"flex items-center mb-3"},Ie={class:"flex items-center mb-3"},De={class:""},Ce={class:"flex gap-5"},_e={class:"mb-2"},Fe={class:"mb-2"};function Ve(l,e,p,h,o,n){const w=E,a=z,y=X,d=O,x=L,I=A,S=R,k=M,D=B,C=N,_=j,F=U,b=q,V=T;return f(),u(Q,null,[t(w),i("div",W,[i("div",G,[i("div",K,[e[22]||(e[22]=i("h1",{class:"text-xl font-bold"},"Xodimlar ro‘yxati",-1)),t(a,{icon:"pi pi-refresh","aria-label":"Save",severity:"secondary",class:"border-0 hover:!border-0",style:{"background-color":"transparent"},onClick:e[0]||(e[0]=s=>n.refreshWorkerData())})]),i("div",Z,[t(y,{modelValue:o.search,"onUpdate:modelValue":e[1]||(e[1]=s=>o.search=s),placeholder:"Qidirish...",class:"w-[200px]"},null,8,["modelValue"]),t(a,{label:"Qo‘shish",icon:"pi pi-plus",onClick:n.openCreate},null,8,["onClick"])])])]),i("div",$,[t(S,{value:n.items,loading:!1,dataKey:"id",expandedRows:o.expandedRows,"onUpdate:expandedRows":e[2]||(e[2]=s=>o.expandedRows=s),style:{width:"90%"},paginator:"",rows:5},{expansion:r(({data:s})=>[i("div",ne,[e[23]||(e[23]=i("div",{class:"flex justify-between items-center mb-2"},[i("h4",{class:"font-semibold"},"Xodim tarixi")],-1)),t(S,{value:s.stories||[],size:"small"},{default:r(()=>[t(d,{field:"id",header:"ID",style:{width:"60px"}}),t(d,{field:"description",header:"Tavsif"}),t(d,{field:"price",header:"Foiz / Qiymat"}),t(d,{header:"Holati"},{body:r(({data:m})=>[t(I,{value:m.status,severity:n.statusColor(m.status)},null,8,["value","severity"])]),_:2},1024),t(d,{header:"Amallar",style:{width:"120px"}},{body:r(({data:m})=>[t(a,{icon:"pi pi-pencil",severity:"info",class:"mr-2",onClick:g=>n.openStoryEdit(m)},null,8,["onClick"]),t(a,{icon:"pi pi-trash",severity:"danger",onClick:g=>n.openDeleteStoryDialog(m,s)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["value"])])]),default:r(()=>[t(d,{expander:"",style:{width:"1rem"}}),t(d,{field:"id",header:"ID",style:{width:"70px"}}),t(d,{field:"fullname",header:"F.I.Sh"}),t(d,{field:"qualification",header:"Ma'lumoti"}),t(d,{header:"Mutaxassislik"},{body:r(({data:s})=>[s.specialityIds?.length?(f(),u("span",ee,c(s.specialityIds.map(m=>o.specialities.find(g=>g.id===m)?.name).filter(Boolean).join(", ")),1)):(f(),u("span",se,"—"))]),_:1}),t(d,{header:"Maoshi"},{body:r(({data:s})=>[s.price?(f(),u("span",te,c(s.price),1)):(f(),u("span",ie,"—"))]),_:1}),t(d,{field:"phoneNumber",header:"Telefon"}),t(d,{header:"Shartnoma"},{body:r(({data:s})=>[s.passportBase64?(f(),Y(x,{key:0,preview:""},{image:r(()=>[i("img",{src:s.passportBase64,class:"w-16 h-10 object-contain rounded"},null,8,oe)]),preview:r(()=>[i("img",{src:s.passportBase64,class:"w-[700px] h-[700px] object-contain"},null,8,le)]),_:2},1024)):(f(),u("span",re,"—"))]),_:1}),t(d,{header:"Amallar",style:{width:"150px"}},{body:r(({data:s})=>[i("div",ae,[t(a,{icon:"pi pi-plus",severity:"success",onClick:m=>n.openStoryCreate(s)},null,8,["onClick"]),t(a,{icon:"pi pi-pencil",class:"!bg-[#0ea5e9] !border-0",onClick:m=>n.openEdit(s)},null,8,["onClick"]),t(a,{icon:"pi pi-trash",severity:"danger",onClick:m=>n.openDeleteDialog(s)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","expandedRows"])]),t(b,{visible:o.dialog,"onUpdate:visible":e[12]||(e[12]=s=>o.dialog=s),modal:"",header:o.editId?"Xodimni tahrirlash":"Yangi xodim qo‘shish",style:{width:"35rem"}},{default:r(()=>[i("div",de,[i("div",me,[e[24]||(e[24]=i("label",{class:"font-semibold block mb-1 w-[15rem]"},"F.I.Sh",-1)),t(y,{modelValue:o.form.fullname,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.fullname=s),class:"w-full"},null,8,["modelValue"])]),i("div",pe,[e[25]||(e[25]=i("label",{class:"font-semibold block mb-1 w-[15rem]"},"Ma'lumoti",-1)),t(y,{modelValue:o.form.qualification,"onUpdate:modelValue":e[4]||(e[4]=s=>o.form.qualification=s),class:"w-full"},null,8,["modelValue"])]),i("div",fe,[e[26]||(e[26]=i("label",{class:"font-semibold block mb-1 w-[15rem]"},"Tavsif",-1)),t(k,{modelValue:o.form.description,"onUpdate:modelValue":e[5]||(e[5]=s=>o.form.description=s),rows:"3",class:"w-full"},null,8,["modelValue"])]),i("div",ue,[e[27]||(e[27]=i("label",{class:"font-semibold block mb-1 w-[15rem]"},"Telefon",-1)),t(D,{mask:"+999 (99) 999 99 99",placeholder:"+998 (99) 999 99 99",modelValue:o.form.phoneNumber,"onUpdate:modelValue":e[6]||(e[6]=s=>o.form.phoneNumber=s),class:"w-full"},null,8,["modelValue"])]),i("div",ce,[e[28]||(e[28]=i("label",{class:"font-semibold block mb-1 w-[10rem]"},"Mutaxassisliklar",-1)),t(C,{modelValue:o.form.specialityIds,"onUpdate:modelValue":e[7]||(e[7]=s=>o.form.specialityIds=s),options:o.specialities,optionLabel:"name",optionValue:"id",display:"chip",filter:"",placeholder:"Tanlang",class:"flex-auto"},null,8,["modelValue","options"])]),i("div",he,[e[29]||(e[29]=i("label",{class:"font-semibold block mb-1 w-[10rem]"},"Moshi",-1)),t(_,{modelValue:o.form.price,"onUpdate:modelValue":e[8]||(e[8]=s=>o.form.price=s),mode:"decimal",useGrouping:!1,placeholder:"Maosh",class:"flex-auto"},null,8,["modelValue"])]),i("div",ye,[e[31]||(e[31]=i("label",{class:"font-semibold block mb-1 w-[160px]"},"Shartnoma",-1)),i("div",be,[t(F,{mode:"basic",customUpload:"",auto:"",accept:"image/*",chooseLabel:"Fayl tanlash",class:"p-button-outlined",onSelect:e[9]||(e[9]=s=>n.onFileSelect(s,"passport"))}),o.passport.type==="image"?(f(),u("div",ge,[t(x,{alt:"Image",preview:""},{previewicon:r(()=>[...e[30]||(e[30]=[i("i",{class:"pi pi-search"},null,-1)])]),image:r(()=>[i("img",{src:o.passport.src,class:"w-[70px] h-[70px] object-contain rounded cursor-pointer border"},null,8,ve)]),preview:r(()=>[i("img",{src:o.passport.src,class:"w-[700px] h-[700px] object-contain rounded"},null,8,xe)]),_:1}),i("button",{type:"button",class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition",onClick:e[10]||(e[10]=s=>n.removeFile("passport"))}," ✕ ")])):J("",!0)])])]),i("div",Se,[t(a,{label:"Bekor qilish",severity:"secondary",onClick:e[11]||(e[11]=s=>o.dialog=!1)}),t(a,{label:"Saqlash",onClick:n.saveItem,disabled:!n.isFormComplete},null,8,["onClick","disabled"])])]),_:1},8,["visible","header"]),t(b,{visible:o.deleteDialog,"onUpdate:visible":e[14]||(e[14]=s=>o.deleteDialog=s),modal:"",header:"O‘chirish",style:{width:"25rem"}},{footer:r(()=>[t(a,{label:"Yo‘q",severity:"secondary",onClick:e[13]||(e[13]=s=>o.deleteDialog=!1)}),t(a,{label:"Ha",severity:"danger",onClick:n.confirmDelete},null,8,["onClick"])]),default:r(()=>[i("p",null,[i("b",null,c(o.deleteItem?.fullname),1),e[32]||(e[32]=v(" nomli xodimni o‘chirmoqchimisiz? ",-1))])]),_:1},8,["visible"]),t(b,{visible:o.storyDialog,"onUpdate:visible":e[19]||(e[19]=s=>o.storyDialog=s),modal:"",header:o.editingStoryId?"Tarixni tahrirlash":"Yangi tarix qo‘shish",style:{width:"30rem"}},{footer:r(()=>[t(a,{label:"Bekor qilish",severity:"secondary",onClick:e[18]||(e[18]=s=>o.storyDialog=!1)}),t(a,{label:"Saqlash",onClick:n.saveStory,disabled:!o.storyForm.status},null,8,["onClick","disabled"])]),default:r(()=>[i("div",null,[i("div",ke,[e[33]||(e[33]=i("label",{class:"font-semibold block w-[10rem]"},"Tavsif",-1)),t(k,{modelValue:o.storyForm.description,"onUpdate:modelValue":e[15]||(e[15]=s=>o.storyForm.description=s),rows:"3",cols:"30",placeholder:"Tavsif",class:"flex-auto"},null,8,["modelValue"])]),i("div",we,[e[34]||(e[34]=i("label",{class:"font-semibold block w-[10rem]"},"Miqdor",-1)),t(y,{modelValue:o.storyForm.price,"onUpdate:modelValue":e[16]||(e[16]=s=>o.storyForm.price=s),placeholder:"Masalan: 10%",class:"flex-auto"},null,8,["modelValue"])]),i("div",Ie,[e[35]||(e[35]=i("label",{class:"font-semibold block w-[10rem]"},"Holati",-1)),t(V,{modelValue:o.storyForm.status,"onUpdate:modelValue":e[17]||(e[17]=s=>o.storyForm.status=s),options:o.storyStatuses,placeholder:"Holatini tanlang",class:"flex-auto"},null,8,["modelValue","options"])])])]),_:1},8,["visible","header"]),t(b,{visible:o.deleteStoryDialog,"onUpdate:visible":e[21]||(e[21]=s=>o.deleteStoryDialog=s),modal:"",header:"Tarixni o‘chirish",style:{width:"30rem"}},{footer:r(()=>[t(a,{label:"Bekor qilish",severity:"secondary",onClick:e[20]||(e[20]=s=>o.deleteStoryDialog=!1)}),t(a,{label:"O'chirish",severity:"danger",onClick:n.confirmDeleteStory},null,8,["onClick"])]),default:r(()=>[i("div",De,[i("div",Ce,[i("p",_e,[e[36]||(e[36]=i("b",null,"ID:",-1)),v(" "+c(o.storyToDelete?.id),1)]),i("p",Fe,[e[37]||(e[37]=i("b",null,"Xodim:",-1)),v(" "+c(o.currentStaff?.fullname),1)])]),e[38]||(e[38]=i("p",{class:"text-red-600 font-semibold"}," Ushbu tarixni o‘chirishni xohlaysizmi? ",-1))])]),_:1},8,["visible"])],64)}const js=H(P,[["render",Ve]]);export{js as default};
