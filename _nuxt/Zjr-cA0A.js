import T from"./DIBwPwDj.js";import V from"./BryanTCJ.js";import S from"./xDwJMEyM.js";import M from"./EglQTkIW.js";import W from"./BG8ZiNcl.js";import U from"./Dw8mO7dl.js";import N from"./CBy416T5.js";import O from"./BJtHImfm.js";import B from"./HD3xI_al.js";import j from"./BHwS6zDY.js";import{_ as L,c,b as s,a as i,w as n,t as a,F as k,o as u,r as w,d as h,g as q}from"./DxA_6M4S.js";import"./CLs7nh7g.js";import"./BGrBkppK.js";import"./BW7sQ8Lu.js";import"./CbawUMde.js";import"./ijkNNglz.js";import"./thNPohIa.js";import"./jc0MLXVe.js";import"./DouVao_c.js";import"./C8iaunkn.js";import"./C79yHB0e.js";import"./ZhWAdK_X.js";import"./BcUHxBSF.js";import"./8vuBrtXB.js";import"./DwlBMqEc.js";import"./GVsM33M1.js";import"./DQLcNeSC.js";import"./BFowhLd_.js";import"./CTbMIecC.js";import"./CtVUFbQO.js";import"./BTljArdg.js";import"./BCbzf2ED.js";import"./DDsLHn0g.js";import"./DhN9Eg6u.js";import"./BnFtnzt4.js";import"./CYFkHn33.js";import"./AZeH9B--.js";import"./CZAN6ZpF.js";import"./CsUkdxJc.js";import"./BHgxdqs7.js";import"./C3PeS6J-.js";import"./HqtNy2EV.js";import"./Bbm53JId.js";import"./D1kS4vDD.js";import"./B48tAO08.js";import"./CeCEF__c.js";import"./CtbL_ZA2.js";import"./DGOY5jSQ.js";import"./vMuEqOGS.js";import"./sCVA-Tgw.js";import"./C8lXrKZ8.js";import"./IQCu99C0.js";import"./BDCSQwEq.js";const E={setup(){},mounted(){this.loadWorkers(),this.loadSpecialities(),this.loadWorks()},data(){return{works:[],workers:[],specialities:[],deleteDialog:!1,workToDelete:null,dialog:!1,editId:null,form:{source:"",description:"",amount:null,workers:[],createAt:null,finishedAt:null},idCount:0}},computed:{workerMap(){return Object.fromEntries(this.workers.map(t=>[t.id,t]))},specialityMap(){return Object.fromEntries(this.specialities.map(t=>[t.id,t.name]))},workerOptions(){return this.workers.map(t=>{const e=(t.specialityIds||[]).map(f=>this.specialityMap[f]).filter(Boolean);return{id:t.id,name:t.fullname,specialitiesText:e.join(", ")}})},totalAmount(){return this.works.reduce((t,e)=>t+Number(e.amount||0),0)}},methods:{loadWorkers(){this.workers=JSON.parse(localStorage.getItem("staffs")||"[]")},loadSpecialities(){this.specialities=JSON.parse(localStorage.getItem("specialities")||"[]")},loadWorks(){this.works=JSON.parse(localStorage.getItem("works")||"[]")},saveWorks(){localStorage.setItem("works",JSON.stringify(this.works))},openCreate(){this.editId=null,this.form={source:"",description:"",amount:null,workers:[],createAt:null,finishedAt:null},this.dialog=!0},openEdit(t){this.editId=t.id,this.form={source:t.source,description:t.description,amount:t.amount,workers:Array.isArray(t.workers)?[...t.workers]:[],createAt:t.createAt,finishedAt:t.finishedAt?this.parseDate(t.finishedAt):null},this.dialog=!0},saveWork(){const t={...this.form,workers:[...this.form.workers],createAt:this.form.createAt||new Date().toLocaleDateString("ru-RU"),finishedAt:this.form.finishedAt?this.form.finishedAt.toLocaleDateString("ru-RU"):null};if(this.editId){const e=this.works.findIndex(f=>f.id===this.editId);e!==-1&&(this.works[e]={...t,id:this.editId})}else this.works.push({...t,id:++this.idCount,createAt:new Date().toLocaleDateString("ru-RU")});this.saveWorks(),this.dialog=!1},openDeleteDialog(t){this.workToDelete=t,this.deleteDialog=!0},confirmDeleteWork(){this.workToDelete&&(this.works=this.works.filter(t=>t.id!==this.workToDelete.id),this.saveWorks(),this.$toast.add({severity:"success",summary:"O‘chirildi",detail:`"${this.workToDelete.source}" o‘chirildi`,life:2e3}),this.deleteDialog=!1,this.workToDelete=null)},parseDate(t){const[e,f,b]=t.split(".");return new Date(b,f-1,e)},removeWorker(t){this.form.workers=this.form.workers.filter(e=>e!==t)}}},J={class:"w-[95%] mx-auto mt-6"},F={class:"flex justify-between mb-4"},K={class:"flex flex-col text-sm"},R={class:"flex gap-2"},X={class:"text-right mt-3 font-bold"},Q={class:""},Y={class:"flex items-center mb-3"},z={class:"flex items-center mb-3"},P={class:"flex items-center mb-3"},G={class:"flex items-center mb-3"},H={class:"flex flex-col"},Z={class:"font-medium"},$={class:"text-xs text-gray-500"},ee={key:0,class:"flex gap-1 flex-wrap"},te=["onClick"],oe={key:1,class:"text-gray-400"},ie={class:"flex items-center mb-3"},se={class:"mb-2"};function re(t,e,f,b,r,l){const v=j,p=B,d=O,y=N,_=U,D=W,A=M,C=S,I=V,g=T;return u(),c(k,null,[s(v),i("div",J,[i("div",F,[e[9]||(e[9]=i("h2",{class:"text-xl font-bold"},"Daromadlar va ishlar",-1)),s(p,{label:"Qo‘shish",icon:"pi pi-plus",onClick:l.openCreate},null,8,["onClick"])]),s(y,{value:r.works,dataKey:"id"},{default:n(()=>[s(d,{field:"id",header:"T/r",style:{width:"70px"}}),s(d,{field:"source",header:"Manbalar"}),s(d,{field:"description",header:"Amalga oshirish shakli"}),s(d,{header:"Xodimlar"},{body:n(({data:o})=>[i("div",K,[(u(!0),c(k,null,w(o.workers||[],m=>(u(),c("span",{key:m},[h(a(l.workerMap[m]?.fullname)+" — ",1),i("i",null,a((l.workerMap[m]?.specialityIds||[]).map(x=>l.specialityMap[x]).filter(Boolean).join(", ")),1)]))),128))])]),_:1}),s(d,{field:"amount",header:"Kutilayotgan natija (mln so‘m)"},{body:n(({data:o})=>[h(a(Number(o.amount||0).toLocaleString()),1)]),_:1}),s(d,{header:"Yaratilgan sana"},{body:n(({data:o})=>[h(a(o.createAt||"—"),1)]),_:1}),s(d,{header:"Tugatish sana"},{body:n(({data:o})=>[h(a(o.finishedAt||"—"),1)]),_:1}),s(d,{header:"Amallar",style:{width:"120px"}},{body:n(({data:o})=>[i("div",R,[s(p,{icon:"pi pi-pencil",severity:"info",onClick:m=>l.openEdit(o)},null,8,["onClick"]),s(p,{icon:"pi pi-trash",severity:"danger",onClick:m=>l.openDeleteDialog(o)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"]),i("div",X," Jami: "+a(l.totalAmount.toLocaleString())+" mln so‘m ",1)]),s(g,{visible:r.dialog,"onUpdate:visible":e[6]||(e[6]=o=>r.dialog=o),modal:"",header:r.editId?"Ishni tahrirlash":"Yangi ish qo‘shish",style:{width:"33rem"}},{footer:n(()=>[s(p,{severity:"secondary",label:"Bekor qilish",onClick:e[5]||(e[5]=o=>r.dialog=!1)}),s(p,{label:r.editId?"Saqlash":"Qo‘shish",onClick:l.saveWork},null,8,["label","onClick"])]),default:n(()=>[i("div",Q,[i("div",Y,[e[10]||(e[10]=i("label",{class:"font-semibold block mb-1 w-[11rem]"},"Manba",-1)),s(_,{modelValue:r.form.source,"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.source=o),placeholder:"Manba",class:"flex-auto"},null,8,["modelValue"])]),i("div",z,[e[11]||(e[11]=i("label",{class:"font-semibold block mb-1 w-[11rem]"},"Tavsilotlar",-1)),s(D,{modelValue:r.form.description,"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.description=o),rows:"3",placeholder:"Ish tavsifi",class:"flex-auto"},null,8,["modelValue"])]),i("div",P,[e[12]||(e[12]=i("label",{class:"font-semibold block mb-1 w-[11rem]"},"Kutilayotgan natija",-1)),s(A,{modelValue:r.form.amount,"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.amount=o),placeholder:"Miqdor (mln so‘m)",class:"flex-auto"},null,8,["modelValue"])]),i("div",G,[e[13]||(e[13]=i("label",{class:"font-semibold block mb-1 w-[11rem]"},"Biriktirilgan xodimlar",-1)),s(C,{modelValue:r.form.workers,"onUpdate:modelValue":e[3]||(e[3]=o=>r.form.workers=o),options:l.workerOptions,optionLabel:"name",optionValue:"id",filter:"",filterFields:["name","specialitiesText"],placeholder:"Xodimlarni tanlang",appendTo:"body",class:"custom-multiselect flex-auto"},{option:n(({option:o})=>[i("div",H,[i("span",Z,a(o.name),1),i("span",$,a(o.specialitiesText),1)])]),value:n(({value:o})=>[o?.length?(u(),c("div",ee,[(u(!0),c(k,null,w(o,m=>(u(),c("span",{key:m,class:"px-2 py-1 text-xs rounded bg-green-100 text-green-800"},[h(a(l.workerMap[m]?.fullname)+" ",1),i("i",{class:"pi pi-times text-[10px] cursor-pointer",onClick:q(x=>l.removeWorker(m),["stop"])},null,8,te)]))),128))])):(u(),c("span",oe,"Xodimlarni tanlang"))]),_:1},8,["modelValue","options"])]),i("div",ie,[e[14]||(e[14]=i("label",{class:"font-semibold block mb-1 w-[11rem]"},"Tugatish vaqti",-1)),s(I,{modelValue:r.form.finishedAt,"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.finishedAt=o),class:"flex-auto"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),s(g,{visible:r.deleteDialog,"onUpdate:visible":e[8]||(e[8]=o=>r.deleteDialog=o),modal:"",header:"Ishni o‘chirish",style:{width:"28rem"}},{footer:n(()=>[s(p,{label:"Bekor qilish",severity:"secondary",onClick:e[7]||(e[7]=o=>r.deleteDialog=!1)}),s(p,{label:"O‘chirish",severity:"danger",onClick:l.confirmDeleteWork},null,8,["onClick"])]),default:n(()=>[i("p",se,[e[15]||(e[15]=i("b",null,"Manba:",-1)),h(" "+a(r.workToDelete?.source),1)]),e[16]||(e[16]=i("p",{class:"text-red-600 font-semibold"}," Ushbu ishni o‘chirishni xohlaysizmi? ",-1))]),_:1},8,["visible"])],64)}const rt=L(E,[["render",re]]);export{rt as default};
